---
title: "Final Project"
author: "Jason Pattison, ST558-651, SUM I 2024"
format: html
editor: visual
editor_options: 
  chunk_output_type: console
---

## Diabetes Health Indicators - EDA

### Introduciton

1. Briefly describe the data and variables we have to work with (only the ones that will be investigated/used in analysis)

2. Describe the purpose of the EDA and ultimate goal of modeling

### Data

```{r warning=FALSE, message=FALSE}

library(dplyr)
library(ggplot2)
library(scales)

```


1. Use relavtive path to import the data
```{r Import, parse, and frame the data set}
# Use a relative path to import the data. Convert variables to factors with 
# meaningful names

diabetes_df <- read.csv("diabetes_binary_health_indicators_BRFSS2015.csv")

diabetes_df <- as_tibble(diabetes_df)

diabetes_df

```
Check for missingness

```{r Check data set for NA values}

list("Number of missing values in data set" = sum(is.na(diabetes_df)))

```

```{r Convert factor variables to factors}

diabetes_df <- diabetes_df |>
  rename("HasDiabetes" = Diabetes_binary, 
         "HighCholesterol" = HighChol, 
         "CholesterolChecked" = CholCheck, 
         "ConsumesFruits" = Fruits, 
         "ConsumesVeggies" = Veggies, 
         "HeavyAlcoholUse" = HvyAlcoholConsump,
         "HasHealthcare" = AnyHealthcare,
         "ExpensiveTreatment" = NoDocbcCost,
         "GeneralHealth" = GenHlth,
         "MentalHealth" = MentHlth,
         "PhysicalHealth" = PhysHlth,
         "DifficultyWalking" = DiffWalk) |>
  mutate(across(c(1:4, 6:15, 18:22), as.factor))

str(diabetes_df)
```
Review of our data frame structure shows that we have successfully renamed our variables and converted the categorical variables to factors. 

Next we will generate a summary of the variables to provide insight on what we will expect to see during our EDA.  
```{r Data set summary of variables}

summary(diabetes_df)

```

**BMI** appears to be generally centered with outliers in the right tail. **MentalHealth** and **PhysicalHealth** both appear to have a tendency response of "0" in the survey. **HighBP**, **HighCholesterol**, **Smoker**, **GeneralHealth**, **Sex** and **Age** each have a fairly equal distribution of responses. The remaining binary variables of **CholesterolChecked**, **Stroke**, **HeartDiseaseorAttack**, **PhysActivity**, **ConsumesFruits**, **ConsumesVeggies**, **HeavyAlcoholUse**, **HasHealthcare**, **ExpensiveTreatment**, and **DifficultyWalking** each heavily favor one response over the other. The variables of **Education** and **Income** both show an increase in responses as the category range values increase. 

### Summarizations

1. Produce meaningful summary stats and plots about the data being analyzed, particularly with how the variables relate to the response

2. Do EDA on the complete data set

3. Ensure narratives explain what we are exploring and what the summaries/graphs created say about the relationships in the data

The first variable we will investigate is **HighBP**. Review of the variable summary information shows
```{r HighBP Summary}

print(list("Summary of HighBP"=summary(diabetes_df$HighBP)))

```
there are greater number of observations of PTs not having high blood pressure to those that do in a ratio of approximately 7:5. This is fairly close to being 1:1, so any differences between the **HasDiabetes** categories would be due to interactions between the variables.  

Using a bar plot to observe **HighBP** with respect to **HasDiabetes** shows
```{r HighBP by HasDiabetes, warning=FALSE, message=FALSE}

HighBP_by <- diabetes_df |>
  group_by(HasDiabetes, HighBP) |>
  summarize(count = n())

HighPB_plot <- ggplot(HighBP_by, aes(HasDiabetes, count, fill=HighBP)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_text(aes(label = count), position = position_dodge(width=0.9), vjust=-0.25) +
  scale_y_continuous(labels = comma) +
  labs(title = "Bar Plot of HighBP by HasDiabetes", x="Has Diabetes", y="# of PTs")

HighPB_plot

```

that the majority of PTs with diabetes have high blood pressure while the majority of PTs without diabetes do not have high blood pressure. The observations in the "No" **HasDiabetes** category have a "No" to "Yes" **HighBP** ratio of approximately 68:41, which is close to 2:1. The observations in the "Yes" **HasDiabetes** category have a "No" to "Yes" **HighBP** ratio of approximately 1:3. This flip in ratios between the **HasDiabetes** groups suggests that there is a relationship between **HasDiabetes** and **HighBP**. 

The next variable that we will investigate is **HighCholesterol**. Review of the variable summary information shows
```{r HighCholesterol summary}

print(list("Summary of HighCholesterol"=summary(diabetes_df$HighCholesterol)))

```
there is approximately a 15:11 "No" to "Yes" ratio of **HighCholesterol** observations. This distribution is fairly close to being 1:1, so any differences between the **HasDiabetes** categories would be due to interactions between the variables. 
 
Using a bar plot to observe **HighCholesterol** with respect to **HasDiabetes** we see
```{r Bar Plot HighCholesterol by HasDiabetes, warning=FALSE, message=FALSE}

HighCholesterol_by <- diabetes_df |>
  group_by(HasDiabetes, HighCholesterol) |>
  summarize(count = n())

HighCholesterol_plot <- ggplot(HighCholesterol_by, aes(HasDiabetes, count, fill=HighCholesterol)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_text(aes(label = count), position = position_dodge(width=0.9), hjust=0.5) +
  scale_y_continuous(labels = comma) +
  labs(title="Bar Plot of HighCholesterol by HasDiabetes", x="Has Diabetes", y= "# of PTs") +
  coord_flip()

HighCholesterol_plot

```

that the ratios change between the **HasDiabetes** groups. While the ratios favor low cholesterol in the group without diabetes, they favor high cholesterol levels in the group with diabetes. There is approximately a 13:8 (nears 2:1) ratio of "No" to "Yes" **HighCholesterol** responses in the "No" **HasDiabetes** group. There is approximately a 11:23 (nears 1:2) ratio of "No" to "Yes" **HighCholesterol** responses in the "Yes" **HasDiabetes** group. The shift in ratios between the groups trending towards PTs with diabetes having high cholesterol suggests that there is a relationship between **HasDiabetes** and **HighCholesterol**. 

The next variable we will investigate is **CholesterolChecked**. Review of the variable summary information shows
```{r CholesterolChecked summary}

print(list("Summary of CholesterolChecked"=summary(diabetes_df$CholesterolChecked)))

```

that the overwhelming majority of PTs had their cholesterol checked at a ratio of 1:27 when compared to those who did not. Any differences between the **HasDiabetes** groups may be heavily influenced by the number of observations in each group more than the interaction between the variables. Review of a bar plot of **CholesterolChecked** with respect to **HasDiabetes** shows
```{r Bar plot of CholesterolChecked by HasDiabetes}

CholesterolChecked_by <- diabetes_df |>
  group_by(HasDiabetes, CholesterolChecked) |>
  summarize(count = n())

CholesterolChecked_plot <- ggplot(CholesterolChecked_by, aes(HasDiabetes, count, fill=CholesterolChecked)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_text(aes(label = count), position = position_dodge(width=0.9), vjust=-0.25) +
  scale_y_continuous(labels = comma) +
  labs(title="Bar Plot of CholesterolChecked by HasDiabetes", x="Has Diabetes", y= "# of PTs")

CholesterolChecked_plot

```

that the group of "Yes" **CholesterolChecked** responses dominates both categories of **HasDiabetes**.   
The "No" **HasDiabetes** group has a "No" to "Yes" **CholesterolChecked** ratio of approximately 1:23. The "YES" **HasDiabetes** group has a "No" to "Yes" **CholesterolChecked** ratio of approximately 1:146. This information suggests that there is an increased likelihood of a PT having diabetes if they have their cholesterol checked. Because it is unlikely that checking cholesterol levels will cause diabetes, **CholesterolChecked** is not a good variable for use in prediction modeling. 


The next variable we will investigte is **BMI**. Review of the variable summary information shows
```{r BMI summary}

print(list("Summary of BMI"=summary(diabetes_df$BMI)))

```

that the data has an IQR span of 7, a Median of 27, and Mean of 28.38. This tells us the data is tightly grouped together with the Min of 12 and Max of 98 being outliers. A histogram of **BMI** shows
```{r Histogram of BMI}

BMI_histogram <- ggplot(diabetes_df, aes(BMI)) +
  geom_histogram(aes(y=..density..), binwidth=1, fill="#CC0000", color="lightgray") +
  labs(title="Histogram of BMI", y="Density (# of PTs)") +
  scale_x_continuous(breaks = seq(0, 100, by = 10)) +
  stat_function(fun=dnorm, args=list(mean=mean(diabetes_df$BMI), sd=sd(diabetes_df$BMI))) 

BMI_histogram

```

that the data follows a generally normal distribution with some skewness to the right. The histogram also confirms there are outleirs in the **BMI** ranges of 12-14 and 50-98. 

Splitting the **BMI** histogram with respect to **HasDiabetes** shows
```{r Histogram of BMI with respect to HasDiabetes}

BMI_by_histplot <- ggplot(diabetes_df, aes(BMI)) +
  geom_histogram(aes(y=..density..), binwidth=1, fill="#CC0000", color="lightgray") +
  labs(title="Histogram of BMI by HasDiabetes", y="Density (# of PTs)") +
  scale_x_continuous(breaks = seq(0, 100, by = 10)) +
  stat_function(fun=dnorm, args=list(mean=mean(diabetes_df$BMI), sd=sd(diabetes_df$BMI))) +
  facet_grid(~HasDiabetes)

BMI_by_histplot

```

that the distribution of observations in the "No" **HasDiabetes** group has a center near a BMI of 25 while the "Yes" **HasDiabetes** group has a center near a BMI of 30  Review of side by side box and whisker plots for the **HasDiabetes** subgroups 
```{r Comparison of BMI group stat summaries}

BMI_by_boxwplot <- ggplot(diabetes_df, aes(HasDiabetes, BMI)) +
  geom_boxplot(aes(group=HasDiabetes), fill="#CC0000") +
  scale_y_continuous(breaks = seq(0, 100, by = 10)) +
  labs(title="Box Plot of BMI by HasDiabetes")

BMI_by_boxwplot

```

confirms that the Median, Mean, and IQR spreads for the "Yes" **HasDiabetes** group are all higher than those of the "No" group. Additionally, the box plot identifies that there is a shared oultier BMI range of 46-98. 

Looking back at the **BMI** histogram, the data in the BMI range of 12-14 and 46-50 appear to be inside of 3 standard deviations from the center. Because of this we determine how many BMI values are greater than 50 and how much of the data set those values make up. 
```{r Determine outliers}

highrange <- sum(diabetes_df$BMI > 50)

print(list("Number of BMI Oultiers"=highrange))

print(list("BMI Outlier portion of data set"=highrange/nrow(diabetes_df)))
```

We identified there are of 2175 observations that are outliers, which account for less than 1% of the data set. It would be reasonable to remove these observations from the data set before prediction model training. Analysis of **BMI** indicates that it appears to be a suitable variable for prediction modeling after removal of the outleirs. 
The next varaible we're going to analyze is **Smoker**. Review of the variable summary shows that
```{r Smoker summary}

print(list("Summary of Smoker"=summary(diabetes_df$Smoker)))

```

the ratio of smokers to non-smokers in the study is approximately 14:11. This is distribution between the groups is fairly close to a 1:1 distribution. Any differences between the **HasDiabetes** groups will be due to interactions between the two variables. Reviewing the bar plot of **Smoker** with respect to **HasDiabetes** shows
```{r Bar plot Smoker by HasDiabetes}

Smoker_by <- diabetes_df |>
  group_by(HasDiabetes, Smoker) |>
  summarize(count = n())

Smoker_plot <- ggplot(Smoker_by, aes(HasDiabetes, count, fill=Smoker)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_text(aes(label = count), position = position_dodge(width=0.9), hjust=0.5) +
  scale_y_continuous(labels = comma) +
  labs(title="Bar Plot of Smoker by HasDiabetes", x="Has Diabetes", y= "# of PTs") +
  coord_flip()

Smoker_plot

```

shows that the "No" **HasDiabetes** group has a "No" to "Yes" **Smoker** distribution of approximately 62:47 which is closer to a 1:1 distribution than a 2:1 distribution. The "Yes" **HasDiabetes** group has a "No" to "Yes" **Smoker** distribution of approximately 17:18 which also nears a 1:1 distribution. While the ratios shifts indicate that smokers have a higher likelihood of having diabetes than non smokers, neither **Smoker** group separates itself from the variable in both **HasDiabetes** categories. **Smoker** is not a suitable variable for inclusion in our prediction model. 

The next variable we are going to analyze is **Stroke**. Review of the variable summary shows
```{r Stroke summary}

print(list("Summary of Stroke"=summary(diabetes_df$Stroke)))

```

that **Stroke** has a 24:1 "No" to "Yes" ratio. This suggests that any differences between the **HasDiabetes** groups may be heavily influenced by the number of observations in each group more than the interaction between the variables. Review of a bar plot for **Stroke** with respect to **HasDiabetes** shows
```{r}

Stroke_by <- diabetes_df |>
  group_by(HasDiabetes, Stroke) |>
  summarize(count = n())

Stroke_plot <- ggplot(Stroke_by, aes(HasDiabetes, count, fill=Stroke)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_text(aes(label = count), position = position_dodge(width=0.9), vjust=-0.25) +
  scale_y_continuous(labels = comma) +
  labs(title="Bar Plot of Stroke by HasDiabetes", x="Has Diabetes", y= "# of PTs") 

Stroke_plot

```

that the **Stroke** "No" group is prominent in both groups of **HasDiabetes**. The "No" **HasDiabetes** group has a "No to "Yes" **Stroke** ratio of approximately 211:7 which is close to 30:1. The "Yes" **HasDiabetes** group has a "No to "Yes" **Stroke** ratio of approximately 32:3 which is close to 11:1. While still favoring the "No" **Stroke** group, the reduction in ratios indicates that there is a relationship between **Stroke** and **HasDiabetes**. However, the relationship appears to be where someone who had a stroke is likely to also have diabetes, but not someone who has diabetes is likely to have had a stroke. **Stroke** does not appear to be suitable for inclusion in the prediction model. 

The next variable we are going to analyze is **HeartDisesaseorAttack**. Summary information shows
```{r HeartDiseaseorAttack summary}

print(list("Summary of HeartDiseaseorAttack"=summary(diabetes_df$HeartDiseaseorAttack)))

```

that the ratio between the "No" and "Yes" **HeartDiseaseorAttack** groups is approximately 23:2 which is slightly larger than 11:1. Review of a bar plot for **HeartDiseaseorAttack** with respect to **HasDiabetes** shows
```{r Bar plot of HeartDiseaseorAttack by HasDiabetes}

HeartDiseaseorAttack_by <- diabetes_df |>
  group_by(HasDiabetes, HeartDiseaseorAttack) |>
  summarize(count = n())

HeartDiseaseorAttack_plot <- ggplot(HeartDiseaseorAttack_by, aes(HasDiabetes, count, fill=HeartDiseaseorAttack)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_text(aes(label = count), position = position_dodge(width=0.9), hjust=0.5) +
  scale_y_continuous(labels = comma) +
  labs(title="Bar Plot of HeartDiseaseorAttack by HasDiabetes", x="Has Diabetes", y= "# of PTs") +
  coord_flip()

HeartDiseaseorAttack_plot

```

shows that the "No" **HeartDiseaseorAttack** group is noticably larger than the "Yes" group for each category of **HasDiabetes**. The "No" **HeartDisease** group has a "No" to "Yes" **HeartDiseaseorAttack** ratio of approximately 10:1. The "Yes" **HeartDisease** group has a "No" to "Yes" **HeartDiseaseorAttack** ratio of 27:7 which nears 4:1. The ratio change between the **HasDiabetes** groups suggests that there is a relationship between the variables. However, this relationship appears to be one where someone having diabetes can be used to predict if they have heart disease or have experienced a heart attack, which is not what we're trying to predict. **HeartDiseaseorAttack** does not appear to be suitable for inclusion in the prediction model. 

The next variable we will summarize is **PhysActivity**. Review of the variable summary information shows
```{r PhysicalActivity summary}

print(list("Summary of PhysicalActivity"= summary(diabetes_df$PhysActivity)))

```

the ratio of "No" to "Yes" responses is approximately 6:19 which is slightly less than 1:3. This suggests that differences between the **HasDiabetes** groups may be influenced by the number of "Yes" **PhysActivity** observations. Review of a bar plot of **PhysActivity** with respect to **HasDiabetes** shows
```{r Bar plot of PhysActivity by HasDiabetes}

PhysActivity_by <- diabetes_df |>
  group_by(HasDiabetes, PhysActivity) |>
  summarize(count = n())

PhysActivity_plot <- ggplot(PhysActivity_by, aes(HasDiabetes, count, fill=PhysActivity)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_text(aes(label = count), position = position_dodge(width=0.9), vjust=-0.25) +
  scale_y_continuous(labels = comma) +
  labs(title="Bar Plot of PhysActivity by HasDiabetes", x="Has Diabetes", y= "# of PTs") 

PhysActivity_plot

```

**PhysActivity** is greater in both **HasDiabetes** groups. The "No" **HeartDisease** group has a "No" to "Yes" **PhysActivity** ratio of approximately 5:17 which is slightly less than 1:3. The "Yes" **HeartDisease** group has a "No" to "Yes" **PhysActivity** ratio of approximately 13:22 which is slightly greater than 1:2. This change in ratios shows that there is a relationship between the variables. The relationship appears to be one where someone having diabetes can be used to predict if they participate in physical activity or not, which is not what we're trying to predict. **PhysActivity** does not appear to be suitable for inclusion in the prediction model. 

The next variable we're going to summarize is **ConsumesFruits**. Review of the variable summary information shows
```{r ConsumesFruits summary}

print(list("Summary of ConsumesFruits"=summary(diabetes_df$ConsumesFruits)))

```

that **ConsumesFruits** has a "No" to "Yes" ratio of approximately 9:16, which is slightly greater than a 1:2 distribution. Review of a bar graph of **ConsumesFruits** with respect to **HasDiabetes** shows
```{r Bar plot of ConsumesFruits by HasDiabetes}

ConsumesFruits_by <- diabetes_df |>
  group_by(HasDiabetes, ConsumesFruits) |>
  summarize(count = n())

ConsumesFruits_plot <- ggplot(ConsumesFruits_by, aes(HasDiabetes, count, fill=ConsumesFruits)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_text(aes(label = count), position = position_dodge(width=0.9), hjust=0.5) +
  scale_y_continuous(labels = comma) +
  labs(title="Bar Plot of ConsumesFruits by HasDiabetes", x="Has Diabetes", y= "# of PTs") +
  coord_flip()

ConsumesFruits_plot

```

that both groups of **HasDiabetes** have a greater number of "Yes" **ConsumesFruits** observations. The "No" **HasDiabetes** group has a "No" to "Yes" **ConsumesFruits** ratio of approximately 8:14 which is slightly greater than 1:2. The "Yes" **HasDiabetes** group has a "No" to "Yes" **ConsumesFruits** ratio of approximately 15:21 which is slightly greater than 2:3. This change in ratios shows that there is a relationship between the variables. However, the relationship appears to be one where someone having diabetes can be used to predict if they eat fruits or not, which is not what we're tyring to predict. **ConsumesFruits** does not appear to be suitable for inclusion in the prediction model. 

The next variabel we're going to summarize is **ConsumesVeggies*. Review of the variable summary information shows
```{r ConsumesVeggies summary}

print(list("Summary of ConsumesVeggies"=summary(diabetes_df$ConsumesVeggies)))

```

that the proporiton of "No" to "Yes" responses is approximately 5:21 which is slightly less than 1:4. Review of a bar plot of **ConsumesVeggies** with respect to **HasDiabetes** shows
```{r Bar plot of ConsumesVeggies by HasDiabetes}

ConsumesVeggies_by <- diabetes_df |>
  group_by(HasDiabetes, ConsumesVeggies) |>
  summarize(count = n())

ConsumesVeggies_plot <- ggplot(ConsumesVeggies_by, aes(HasDiabetes, count, fill=ConsumesVeggies)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_text(aes(label = count), position = position_dodge(width=0.9), vjust=-0.25) +
  scale_y_continuous(labels = comma) +
  labs(title="Bar Plot of ConsumesVeggies by HasDiabetes", x="Has Diabetes", y= "# of PTs") 

ConsumesVeggies_plot

```

that the "Yes" **ConsumesVeggies** observations are substantially greater in both categories of **HasDiabetes**. The "No" **HasDiabetes** group has a "No" to "Yes" **ConsumesVeggies** ratio of approximately 2:9 which is slightly less than 1:4. The "Yes" **HasDiabetes** group has a "No" to "Yes" **ConsumesVeggies** ratio of approximately 1:3. The change in ratios between the **HasDiabetes** groups shows that there is a relationship between the variables. However, the relationship appears to be one where someone having diabetes can be used to predict if they eat vegetables or not, which is not what we're trying to predict. **ConsumesVeggies** does not appear to be suitable for inclusion in the prediction model. 

The next variable we're going to summarize is **HeavyAlcoholUse**. Review of the variable summary information shows
```{r HeavyAlcoholUse summary}

print(list("Summary of HeavyAlcoholUse"=summary(diabetes_df$HeavyAlcoholUse)))

```

shows that the ratio of "No" to "Yes" responses is approximately 24:1. This suggests that any differences between the **HasDiabetes** groups may be influenced by the number of observations. Reviewing the bar plot of **HeavyAlcoholUse** with respect to **HeartDisease* shows
```{r Bar plot of HeavyAlcoholUse by HeartDisease}

HeavyAlcoholUse_by <- diabetes_df |>
  group_by(HasDiabetes, HeavyAlcoholUse) |>
  summarize(count = n())

HeavyAlcoholUse_plot <- ggplot(HeavyAlcoholUse_by, aes(HasDiabetes, count, fill=HeavyAlcoholUse)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_text(aes(label = count), position = position_dodge(width=0.9), hjust=0.5) +
  scale_y_continuous(labels = comma) +
  labs(title="Bar Plot of HeavyAlcoholUse by HasDiabetes", x="Has Diabetes", y= "# of PTs") +
  coord_flip()

HeavyAlcoholUse_plot

```

that the "No" **HeavyAlcoholUse** responses constitute the majority of observations in both **HasDiabetes** groups. The "No" **HasDiabetes** group has a "No" to "Yes" **HeavyAlcoholUse** ratio of approximately 205:13 which reduces close to 16:1. The "Yes" **HasDiabetes** group has a "No" to "Yes" **HeavyAlcoholUse** ratio of approximately 345:8 which reduces close to 43:1. The change in ratios shows that there is a relationship between the variables. However, the relationship appears to be one where someone having diabetes can be used to predict if they consume alcohol heavily, which is not what we're trying to predict. **HeavyAlcoholUse** does not appear to be suitable for inclusion in the prediction model. 

HasHealthcare
```{r }



```



ExpensiveTreatment
```{r } 



```



GeneralHealth
```{r }

```



MentalHealth
```{r}

```



PhysicalHealth
```{r}

```



DifficultyWalking
```{r}

```



Sex
```{r}

```



Age
```{r}

summary(diabetes_df$Age)

```



Education
```{r}

```



Income
```{r}
summary(diabetes_df$Income)
```
